"use strict";function init(){if(document.getElementById("split").addEventListener("click",onSplitButtonClick),window.location.search){var t=window.location.search.substring(1);handleOrder(function(){return parseQueryStringInput(t)})}loadPreferences()}function loadPreferences(){Storage&&"false"===localStorage.getItem("isTipPercentage")&&(updateTipComponents(!1),document.getElementById("percentageCheckbox").checked=!1)}function onPercentageCheckboxClick(){var t=document.getElementById("percentageCheckbox").checked;updateTipComponents(t),Storage&&localStorage.setItem("isTipPercentage",t)}function updateTipComponents(t){document.getElementById("fixedSpan").hidden=t,document.getElementById("percentageSpan").hidden=!t}function onSplitButtonClick(){var t=document.getElementById("textarea").value,e=Number(document.getElementById("taxes").value),r=Number(document.getElementById("fees").value),n=Number(document.getElementById("tip").value),i=document.getElementById("percentageCheckbox").checked;handleOrder(function(){return parseOrderUpInput(t,r,e,n,i)})}function handleOrder(t){try{var e=t();e.split(),display(e)}catch(t){alert(t),console.error(t)}}function display(t){var e="<table><tr><td>Subtotal:</td><td>$"+prettifyNumber(t.subTotal)+"</td><td>(user input; sum of item costs)</td></tr><tr><td>Tax:</td><td>$"+prettifyNumber(t.tax)+"</td><td>(user input)</td></tr><tr><td>Fees:</td><td>$"+prettifyNumber(t.fee)+"</td><td>(user input)</td></tr><tr><td>Tip:</td><td>$"+prettifyNumber(t.tipDollars)+"</td><td>("+(t.isTipPercentage?"tip percent * subtotal":"user input")+")</td></tr><tr><td>Total:</td><td>$"+prettifyNumber(t.total)+"</td><td>(subtotal + tax + fees + tip)</td></tr><tr><td>Fees per Person:</td><td>$"+prettifyNumber(t.feesPerPerson)+"</td><td>(fees / number of people)</td></tr><tr><td>Tax (Percent):</td><td>"+t.taxPercentDisplay+"%</td><td>(tax / subtotal)</td></tr><tr><td>Tip (Percent):</td><td>"+t.tipPercentDisplay+"%</td><td>("+(t.isTipPercentage?"user input":"tip / subtotal")+")</td></tr></table>",r="<hr>"+e+"<br>"+makeBreakdownDisplay(t)+"<br>Publish the following:<br><pre>"+makeTotalsDisplay(t.totals)+"</pre>"+makeHyperlink(t.tax,t.fee,t.tip,t.people);document.getElementById("result").innerHTML=r}function prettifyNumber(t){t=Math.round(100*t)/100;var e=t.toString();for(-1===e.indexOf(".")&&(e+=".");e.length<e.indexOf(".")+3;)e+="0";return e}function makeTotalsDisplay(t){var e=-1,r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var l=_slicedToArray(a.value,2),s=l[0];l[1];e=Math.max(s.length,e)}}catch(t){n=!0,i=t}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}e+=1;var u="",d=!0,c=!1,h=void 0;try{for(var f,p=t[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){for(var y=_slicedToArray(f.value,2),v=y[0],m=y[1],g=v,b=v.length;b<e;b++)g+=" ";u+=g+"$"+prettifyNumber(m)+"<br>"}}catch(t){c=!0,h=t}finally{try{!d&&p.return&&p.return()}finally{if(c)throw h}}return u}function makeHyperlink(t,e,r,n){var i=window.location.origin+window.location.pathname;-1===i.indexOf("index.html")&&(i+="index.html"),0!==r&&(r=prettifyNumber(r)),i+="?tax="+t+"&fee="+e+"&tip="+r;var a=!0,o=!1,l=void 0;try{for(var s,u=n[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var d=_slicedToArray(s.value,2),c=d[0],h=d[1];i+="&"+encodeURIComponent(c)+"="+prettifyNumber(h)}}catch(t){o=!0,l=t}finally{try{!a&&u.return&&u.return()}finally{if(o)throw l}}return"<a href="+i+">"+i+"</a>"}function makeBreakdownDisplay(t){var e='<table id="breakdown">';e+="<tr><th>Person</th><th>Item Costs</th><th>Tax</th><th>Tip</th><th>Fees Per Person</th><th>Person Total</th></tr>";var r=!0,n=!1,i=void 0;try{for(var a,o=t.people[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var l=_slicedToArray(a.value,2),s=l[0],u=l[1];e+="<tr><td>"+s+"</td><td>"+u+"</td><td> + "+u+" * "+t.taxPercent+"</td><td> + "+u+" * "+t.tipPercent+"</td><td> + "+t.feesPerPerson+"</td><td> = "+prettifyNumber(t.totals.get(s))+"</td></tr>"}}catch(t){n=!0,i=t}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return e+="</table>"}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function parseQueryStringInput(t){for(var e=t.split("&"),r=new Order,n=0;n<e.length;n++){var i=e[n].split("=");i[1]=Number(i[1]),"fee"===i[0]?r.withNonTaxedFees(i[1]):"tax"===i[0]?r.withTax(i[1]):"tip"===i[0]?r.withTip(i[1]):r.withPerson(decodeURIComponent(i[0]),i[1])}return r}function parseOrderUpInput(t,e,r,n,i){for(var a=(new Order).withNonTaxedFees(e).withTax(r).withTip(n,i),o=null,l=t.split("\n"),s=0;s<l.length;s++){var u=l[s].trim();if(u=u.replace(/\s+/g," "),o){var d=u.indexOf("Label for:");if(d>-1){var c=u.substring(d+"Label for:".length,u.length);a.withPerson(c,o),o=null}}else{var h=u.lastIndexOf("$");h>-1&&(o=Number(u.substring(h+1,u.length)))}}return a}var _slicedToArray=function(){function t(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(i)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.onload=init;var _slicedToArray=function(){function t(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(i)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Order=function(){function t(){_classCallCheck(this,t),this.people=new Map,this.tip=0,this.tax=0,this.nonTaxedFees=0,this.taxedFees=0,this.isTipPercentage=!1}return _createClass(t,[{key:"withTip",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isTipPercentage=e,this.isTipPercentage?this._tipPercentage=t/100:this._tipDollars=t,this}},{key:"withNonTaxedFees",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.nonTaxedFees=e.reduce(function(t,e){return t+e}),this}},{key:"withTaxedFees",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.taxedFees=e.reduce(function(t,e){return t+e}),this}},{key:"withTax",value:function(t){return this.tax=t,this}},{key:"withPerson",value:function(t,e){var r=e;return this.people.has(t)&&(r+=this.people.get(t)),this.people.set(t,r),this}},{key:"split",value:function(){var t=new Map;this.subTotal=0;var e=!0,r=!1,n=void 0;try{for(var i,a=this.people.entries()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=_slicedToArray(i.value,2),l=o[0],s=o[1];this.subTotal+=s}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}this.subTotal+=this.taxedFees;var u=!0,d=!1,c=void 0;try{for(var h,f=this.people.entries()[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=_slicedToArray(h.value,2),l=p[0],s=p[1],y=s;y+=s*this.taxPercent,y+=s*this.tipPercent,y+=this.feesPerPerson,t.set(l,y)}}catch(t){d=!0,c=t}finally{try{!u&&f.return&&f.return()}finally{if(d)throw c}}this.totals=t;var v=Array.from(t.values()).reduce(function(t,e){return t+e});if(Math.round(100*v)!=Math.round(100*this.total))throw new Error("Everyone's share does not add up to total");return this}},{key:"taxPercent",get:function(){return this.tax/this.subTotal}},{key:"taxPercentDisplay",get:function(){return 100*this.taxPercent}},{key:"fee",get:function(){return this.nonTaxedFees}},{key:"tipPercent",get:function(){return this.isTipPercentage?this._tipPercentage:this._tipDollars/this.subTotal}},{key:"tipPercentDisplay",get:function(){return 100*this.tipPercent}},{key:"tipDollars",get:function(){return this.tipPercent*this.subTotal}},{key:"feesPerPerson",get:function(){return this.fee/this.people.size}},{key:"total",get:function(){return this.subTotal+this.fee+this.tipDollars+this.tax}}]),t}();"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(function(t){console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(function(t){console.log("ServiceWorker registration failed: ",t)});